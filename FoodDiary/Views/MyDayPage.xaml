<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:FoodDiary.ViewModels"
             xmlns:models="clr-namespace:FoodDiary.Models"
             xmlns:converters="clr-namespace:FoodDiary.Converters"
             x:Class="FoodDiary.Views.MyDayPage"
             x:DataType="viewModels:MyDayViewModel"
             Title="Mój Dzień">

    <!-- Widok odświeżania, umożliwia przeciągnięcie w dół w celu odświeżenia danych -->
    <RefreshView Command="{Binding RefreshCommand}" IsRefreshing="{Binding IsLoading}">
        <ScrollView>
            <!-- Główny układ pionowy strony -->
            <VerticalStackLayout Padding="15" Spacing="15">

                <!-- Ramka z podsumowaniem dziennym wartości odżywczych -->
                <Frame CornerRadius="10" Padding="15" BorderColor="LightGray">
                    <VerticalStackLayout>
                        <Label Text="Podsumowanie Dzienne" FontSize="Title" FontAttributes="Bold" HorizontalOptions="Center"/>
                        <Label Text="{Binding FormattedDate}" HorizontalOptions="Center" TextColor="Gray"/>

                        <!-- Tabela z wartościami odżywczymi -->
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="5" Margin="0,15,0,0">
                            <Label Grid.Row="0" Grid.Column="0" Text="Kalorie:" HorizontalOptions="End" FontAttributes="Bold"/>
                            <Label Grid.Row="0" Grid.Column="1" Text="{Binding TodaySummary.TotalCalories, StringFormat='{0:F0} kcal'}" />

                            <Label Grid.Row="1" Grid.Column="0" Text="Białko:" HorizontalOptions="End" />
                            <Label Grid.Row="1" Grid.Column="1" Text="{Binding TodaySummary.TotalProtein, StringFormat='{0:F1} g'}" />

                            <Label Grid.Row="2" Grid.Column="0" Text="Tłuszcz:" HorizontalOptions="End" />
                            <Label Grid.Row="2" Grid.Column="1" Text="{Binding TodaySummary.TotalFat, StringFormat='{0:F1} g'}" />

                            <Label Grid.Row="3" Grid.Column="0" Text="Węglowodany:" HorizontalOptions="End" />
                            <Label Grid.Row="3" Grid.Column="1" Text="{Binding TodaySummary.TotalCarbohydrates, StringFormat='{0:F1} g'}" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Nagłówek sekcji z listą posiłków -->
                <Label Text="Twoje Posiłki" FontSize="Title" FontAttributes="Bold" HorizontalOptions="Center" Margin="0,10,0,0"/>

                <!-- Lista posiłków użytkownika na dany dzień -->
                <CollectionView ItemsSource="{Binding Meals}"
                                SelectionMode="Single"
                                SelectionChanged="OnMealSelected">
                    <!-- Widok pusty, gdy nie ma żadnych posiłków -->
                    <CollectionView.EmptyView>
                        <Label Text="Brak posiłków na dzisiaj. Dodaj swój pierwszy posiłek!" Padding="20" HorizontalOptions="Center" TextColor="Gray"/>
                    </CollectionView.EmptyView>
                    <!-- Szablon pojedynczego posiłku -->
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Meal">
                            <Frame Padding="10" Margin="0,5" CornerRadius="8" BorderColor="LightGray" HasShadow="True">
                                <Grid ColumnDefinitions="*, Auto" ColumnSpacing="10">
                                    <!-- Dane posiłku: typ i godzina -->
                                    <VerticalStackLayout Grid.Column="0" Spacing="5" VerticalOptions="Center">
                                        <Label Text="{Binding Type}" FontSize="Medium" FontAttributes="Bold"/>
                                        <Label Text="{Binding MealTime, StringFormat='Godzina: {0:HH:mm}'}" FontSize="Small" TextColor="DarkGray"/>
                                    </VerticalStackLayout>
                                    <!-- Przycisk do usuwania posiłku -->
                                    <Button Grid.Column="1" 
                                            Text="Usuń" 
                                            BackgroundColor="Red"
                                            TextColor="White"
                                            VerticalOptions="Center"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MyDayViewModel}}, Path=DeleteMealCommand}"
                                            CommandParameter="{Binding .}"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Przycisk do dodania nowego posiłku -->
                <Button Text="Dodaj Posiłek" Command="{Binding AddMealCommand}" HorizontalOptions="Fill" Margin="0,15,0,0"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>
